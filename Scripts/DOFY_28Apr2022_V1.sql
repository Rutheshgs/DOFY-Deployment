--Testimonials
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 5, 'Testimonial 1', 'Rita Naveen', 'Service is good and hassle free I repaired my mobile without going to store...'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 100, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 5, 'Testimonial 2', 'Richard Parker', 'I wanted to sell my old camera and really i got reasonable cash in return...'
,1, 1, 'user2.10220eaa68b408a63fd0.webp', 200, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 5, 'Testimonial 3', 'Mark Spencer', 'I could able to sell my old device with hassle free, quick and good price. Thanks to DoFy Team for the wonderfull support.'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 300, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 5, 'Testimonial 4', 'Steve Hardly', 'I wanted to sell my old Watch and really i got reasonable cash in return...'
,1, 1, 'user2.10220eaa68b408a63fd0.webp', 400, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 5, 'Testimonial 5', 'Anita Spencer', 'I could able to sell my old device with hassle free, quick and good price. Thanks to DoFy Team for the wonderfull support.'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 500, 1);

--Youtube
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 6, 'Youtube 1', 'Rita Naveen', 'Service is good and hassle free I repaired my mobile without going to store...'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 100, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 6, 'Youtube 2', 'Richard Parker', 'I wanted to sell my old camera and really i got reasonable cash in return...'
,1, 1, 'user2.10220eaa68b408a63fd0.webp', 200, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 6, 'Youtube 3', 'Mark Spencer', 'I could able to sell my old device with hassle free, quick and good price. Thanks to DoFy Team for the wonderfull support.'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 300, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 6, 'Youtube 4', 'Steve Hardly', 'I wanted to sell my old Watch and really i got reasonable cash in return...'
,1, 1, 'user2.10220eaa68b408a63fd0.webp', 400, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 6, 'Youtube 5', 'Anita Spencer', 'I could able to sell my old device with hassle free, quick and good price. Thanks to DoFy Team for the wonderfull support.'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 500, 1);

--Blogs
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 8, 'Blogs 1', 'Rita Naveen', 'Service is good and hassle free I repaired my mobile without going to store...'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 100, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 8, 'Blogs 2', 'Richard Parker', 'I wanted to sell my old camera and really i got reasonable cash in return...'
,1, 1, 'user2.10220eaa68b408a63fd0.webp', 200, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 8, 'Blogs 3', 'Mark Spencer', 'I could able to sell my old device with hassle free, quick and good price. Thanks to DoFy Team for the wonderfull support.'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 300, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 8, 'Blogs 4', 'Steve Hardly', 'I wanted to sell my old Watch and really i got reasonable cash in return...'
,1, 1, 'user2.10220eaa68b408a63fd0.webp', 400, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(null, 8, 'Blogs 5', 'Anita Spencer', 'I could able to sell my old device with hassle free, quick and good price. Thanks to DoFy Team for the wonderfull support.'
,1, 1, 'user1.b7bc9355fd3b465789f2.webp', 500, 1);

--Hotselling
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(11612, 7, '', '', '',1, 1, null, 100, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(11613, 7, '', '', '',1, 1, null, 100, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(11614, 7, '', '', '',1, 1, null, 100, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(11615, 7, '', '', '',1, 1, null, 100, 1);
Insert into DashboardElements (ModelVariantId, EntityTypeId, Title, AuthorName, Content, DisplayInList, Enabled, ThumbnailPath, RowOrder, Active)
Values(11616, 7, '', '', '',1, 1, null, 100, 1);

Update QuestionnaireType set DisplayName = 'Device Details', EnumName = 'DeviceDetails' where id = 43;
GO

Update QuestionnaireTemplate set QuestionnaireTypeId = 43, Type= 'Questions', AnswerType ='Yes_No'  where Identifier in (4,5,6,7,8)
GO


Update QuestionnaireTemplate set ParentId = 10 where ParentId = 9;

Update QuestionnaireTemplate set Identifier = 10 Where Identifier = 9;
GO

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 45, 3, null, 9, 4, 1, 'Functional or Physical Problems', 'Functional or Physical Problems', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 45, 2, null, 9, 4, 1, 'Functional or Physical Problems', 'Functional or Physical Problems', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);
GO

Update QuestionnaireTemplate set ParentId = 9 where Identifier = 10;
GO

Update QuestionnaireTemplate set ParentId = 30 where ParentId = 7;
GO

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 46, 3, null, 30, 7, 1, 'Do you have the following?', 'Do you have the following?', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 46, 2, null, 30, 7, 1, 'Do you have the following?', 'Do you have the following?', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);
GO

Update QuestionnaireTemplate set ParentId = 36 where ParentId = 5;
GO

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 47, 3, null, 36, 5, 1, 'Tell us more about your device screen defects', 'Tell us more about your devices screen defects', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 47, 2, null, 36, 5, 1, 'Tell us more about your device screen defects', 'Tell us more about your device screen defects', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);
GO

Update QuestionnaireTemplate set ParentId = 54 where ParentId = 6;
GO

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 48, 3, null, 54, 6, 1, 'Tell us more about your devices body defects', 'Tell us more about your devices body defects', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 48, 2, null, 54, 6, 1, 'Tell us more about your devices body defects', 'Tell us more about your devices body defects', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);
GO

Update QuestionnaireTemplate set ParentId = 71 where ParentId = 8;
GO

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 49, 3, null, 71, 6, 1, 'What is your mobile age', 'What is your mobile age', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);

Insert into QuestionnaireTemplate (ProductTypeId, QuestionnaireTypeId, OSTypeId, ModelVariantId, Identifier, ParentId, ThresholdLevel, Name, DisplayName, SubHeading, Type, AnswerType, Threshold, RowOrder, DisplayInList, ThumbnailPath, Enabled, Active)
Values (2, 49, 2, null, 71, 6, 1, 'What is your mobile age', 'What is your mobile age', '', 'Heading', 'None', 0, 100, 1, null, 1, 1);
GO

Alter Table QuestionnaireTemplate
Add IsEditable bit null;
GO


Update QuestionnaireTemplate set IsEditable = 1;
GO

Update QuestionnaireTemplate set IsEditable = 0 where type = 'Heading';
GO

ALTER PROCEDURE [dbo].[GetQuestionnaireTemplate]
    @ProductTypeId bigint,
    @QuestionnaireTypeId bigint,
    @OSTypeId bigint,
    @ModelVariantId bigint,
    @ParentId bigint
AS
    BEGIN

		SELECT qt.Id
			  , qt.ProductTypeId
			  , qt.QuestionnaireTypeId
			  , qt.OSTypeId
			  , @ModelVariantId ModelVariantId
			  , qt.QuestionnaireTypeName
			  , qt.QuestionnaireTypeDisplayName
			  , qt.QuestionnaireTypeEnumName
			  , qt.Identifier
			  , qt.ParentId
			  , qt.Name
			  , qt.DisplayName
			  , qt.EnumName
			  , qt.SubHeading
			  , qt.Type
			  , qt.AnswerType
			  , qt.Threshold
			  , qt.ThresholdLevel
			  , qt.RowOrder
			  , qt.DisplayInList
			  , qt.ThumbnailPath
		  FROM vw_QuestionnaireTemplates qt
		  Where (
					(@ProductTypeId is null or qt.ProductTypeId = @ProductTypeId)
					And (@QuestionnaireTypeId is null or qt.QuestionnaireTypeId = @QuestionnaireTypeId)
					And (@OSTypeId is null or qt.OSTypeId = @OSTypeId)
					And (@ModelVariantId is null or qt.ModelVariantId is null or qt.ModelVariantId = @ModelVariantId)
					And (@ParentId is null or qt.ParentId = @ParentId)
				)
		  Except
		  SELECT qt2.Id
			  , qt2.ProductTypeId
			  , qt2.QuestionnaireTypeId
			  , qt2.OSTypeId
			  , @ModelVariantId ModelVariantId
			  , qt2.QuestionnaireTypeName
			  , qt2.QuestionnaireTypeDisplayName
			  , qt2.QuestionnaireTypeEnumName
			  , qt2.Identifier
			  , qt2.ParentId
			  , qt2.Name
			  , qt2.DisplayName
			  , qt2.EnumName
			  , qt2.SubHeading
			  , qt2.Type
			  , qt2.AnswerType
			  , qt2.Threshold
			  , qt2.ThresholdLevel
			  , qt2.RowOrder
			  , qt2.DisplayInList
			  , qt2.ThumbnailPath
		  FROM vw_QuestionnaireTemplates qt2
		  Where (
					qt2.Enabled = 0
					And (@ProductTypeId is null or qt2.ProductTypeId = @ProductTypeId)
					And (@QuestionnaireTypeId is null or qt2.QuestionnaireTypeId = @QuestionnaireTypeId)
					And (@OSTypeId is null or qt2.OSTypeId = @OSTypeId)
					And (@ModelVariantId is null or qt2.ModelVariantId = @ModelVariantId)
					And (@ParentId is null or qt2.ParentId = @ParentId)
				)
		Order by QuestionnaireTypeId, RowOrder

End
GO

ALTER PROCEDURE [dbo].[GetOrderSummary]
    @OrderId bigint   
AS
    BEGIN

	Declare @QuestionaireVersion bigint = (Select Max(Version) From vw_QuestionnaireResponsesList where OrderId = @OrderId);

	Declare @SeriesModelColorId bigint = (Select Top 1 SeriesModelColorId 
											From vw_OrderPartsList opl
											Inner Join vw_PartTypeList pl on pl.Id = opl.PartTypeId
											where OrderId = @OrderId);

	Declare @RepairTypeCharge Table
	( 
		RepairTypeId bigint,
		Amount decimal (16, 2)
	)

	if (@SeriesModelColorId > 0)
	Begin
		Insert into @RepairTypeCharge
		Select opl.RepairTypeId, 
				Sum(IsNULL(pt.ServiceCharge, 0)) as ServiceCharge
		From vw_OrderPartsList opl			
			Inner Join vw_PartTypeList pt on pt.Id = opl.PartTypeId
		Where opl.OrderId = @OrderId
		Group by opl.OrderId, opl.RepairTypeId
	End

	--Order data
	Select 
                     od.Id,
                     od.PersonId,
                     od.ServiceTypeId,
					 sr.DisplayName as ServiceType,
                     od.ModelVariantId,
					 mv.DisplayName as ModelVariantName,					
					 od.OrderCode,
					 IsNULL(mv.ProductTypeName, sm.ProductTypeName) as ProductTypeName,
					 IsNULL(mv.BrandMasterName, sm.BrandMasterName) as BrandMasterName,
					 IsNULL(mv.SeriesModelName, sm.DisplayName) as SeriesModelName,
					 pl.FullName as UserName,
					 pl.Mobile as UserMobile,
					 pl.SecondaryMobile,									                
                     od.StatusId,
					 od.SuggestedCost,
					 od.FinalPaid,
					 sl.DisplayName as StatusName,
					 IsNULL(mv.ThumbnailPath, sm.ThumbnailPath) as ThumbnailPath,
					 od.CustomerExpectation,
					 @SeriesModelColorId as SeriesModelColorId,
					 smc.DisplayName SeriesModelColor
                 From vw_OrdersList od
					 Left outer Join vw_ModelVariant mv on mv.Id = od.ModelVariantId
					 Left Outer Join vw_SeriesModel sm on sm.Id = od.SeriesModelId
					 Inner Join vw_ServiceTypeList sr on sr.Id = od.ServiceTypeId				 
					 Inner join vw_PersonList pl on pl.Id = od.PersonId
					 Inner Join vw_StatusList sl on sl.Id = od.StatusId
					 Left Outer Join vw_SeriesModelColors smc on smc.Id = @SeriesModelColorId
				 Where od.Id = @OrderId

	--Appointment Data
	--To do --Add address in this table
			Select 
				apl.Id
				, OrderId
				, AssigneeId
				, AppointmentDate
				, StartTime
				, EndTime
				, Remarks
				, TechnicianComments
				, apl.RowOrder
				, IsReschedule
				, apl.Active
				, ua.Address
				, ua.City as AppointmentCity 
				, ua.PinCode as AppointmentPincode 
			From vw_AppointmentList apl
			Left Outer Join vw_UserAddressList ua on ua.Id = apl.UserAddresId
			Where apl.OrderId = @OrderId

	-- Assingee details
		Select pl.Id
			  , LoginId
			  , UserRoleId
			  , FullName AssigneeName			  
			  , Email		  
			  , Mobile
			  , SecondaryMobile
			  , UploadImagePath
			  , UploadImageName
			  , 5 as UserRating
			  , ual.Address
			  , ual.PinCode
			  , ual.CityId
		From vw_PersonList pl
			Inner join vw_AppointmentList apl on apl.AssigneeId = pl.Id
			Left outer join vw_UserAddressList ual on ual.PersonId = pl.Id
		Where apl.OrderId = @OrderId and (ual.Id is null or ual.IsDefault = 1)

		-- Order Documents

		Select 
				odl.Id
				, OrdersId
				, DocumentTypeId
				, DocumentPath
				, odl.RowOrder
				, odl.Active
				, dyl.DisplayName as DocumentTypeName
				, odl.FileName
		From vw_OrderDocumentsList odl
			Inner join vw_DocumentTypeList dyl on dyl.Id = odl.DocumentTypeId
		Where odl.OrdersId = @OrderId

		-- Questionaire Response

		Select qrl.Id
			  , OrderId
			  , QuestionnaireTemplateId
			  , qrl.Selected
			  , qrl.Threshold
			  , qrl.RowOrder
			  , qrl.Version
			  , qrl.Active
			  , qt.DisplayName as Question
			  , qt.AnswerType
			  , qt.ThumbnailPath
			  , qt.Type as QuestionType
			  , qt.QuestionnaireTypeId
			  , qtl.DisplayName as QuestionnaireType
			  , qt.ParentId
			  , Case When qrl.Selected = 1 then qt.ResponseYes 
				When qrl.Selected = 0 then qt.ResponseNo
				Else null End as ResponseText
		From vw_QuestionnaireResponsesList qrl
			Inner Join vw_QuestionnaireTemplateList qt on qt.Id = qrl.QuestionnaireTemplateId
			Inner Join vw_QuestionnaireTypeList qtl on qtl.Id = qt.QuestionnaireTypeId
		Where qrl.OrderId = @OrderId and qrl.Version = @QuestionaireVersion

		Select	@OrderId as OrderId
			  , rt.Id as RepairTypeId
			  , 0 PartTypeId
			  , rt.RowOrder
			  , rt.Active
			  , rt.DisplayName as RepairType
			  , rt.Name as RepairTypeName
			  , '' as PartType
			  , rpt.Amount as ServiceCharge
			  , Case When rpt.RepairTypeId > 0 then 1 else 0 end as [Enabled] 
		From vw_RepairTypeList rt	
			Left Outer join @RepairTypeCharge rpt on rpt.RepairTypeId = rt.Id
		Where rt.Active = 1		
		order by RowOrder

		--OrderSpecifications

		Select os.Id
			, os.OrderId
			, os.IMEINumber
			, os.RowOrder
			, os.IEMIVerified
		from vw_OrderSpecificationsList os 
		where os.OrderId = @OrderId
End
GO

ALTER View [dbo].[vw_QuestionnaireTemplates]
as
SELECT q.Id
      , q.ProductTypeId
      , q.QuestionnaireTypeId
      , q.OSTypeId
	  , q.ModelVariantId
	  , qt.Name as QuestionnaireTypeName
	  , qt.DisplayName as QuestionnaireTypeDisplayName
	  , qt.EnumName as QuestionnaireTypeEnumName
      , q.Identifier
      , q.ParentId
      , q.Name
      , q.DisplayName
      , q.EnumName
      , q.SubHeading
      , q.Type
      , q.AnswerType
      , q.Threshold
	  , q.ThresholdLevel
      , q.RowOrder
      , q.DisplayInList
	  , q.ThumbnailPath
	  , q.Enabled
      , q.Active
      , q.Created
      , q.CreatedBy
      , q.Modified
      , q.ModifiedBy
	  , q.IsEditable
  FROM QuestionnaireTemplate q
	Inner Join QuestionnaireType qt on qt.Id = q.QuestionnaireTypeId 

GO


ALTER View [dbo].[vw_QuestionnaireTemplateList]

AS
       Select 
          Id,
          ProductTypeId,
          QuestionnaireTypeId,
          OSTypeId,
          ModelVariantId,
          Identifier,
          ParentId,
          ThresholdLevel,
          Name,
          DisplayName,
          EnumName,
          SubHeading,
          Type,
          AnswerType,
          Threshold,
          RowOrder,
          DisplayInList,
          ThumbnailPath,
          Enabled,
          Active,
          Created,
          CreatedBy,
          Modified,
          ModifiedBy,
		  ResponseYes,
		  ResponseNo,
		  IsEditable
        From QUESTIONNAIRETEMPLATE (NoLock) 
        Where Active = 1 

GO

ALTER PROCEDURE [dbo].[GetQuestionnaireTemplate]
    @ProductTypeId bigint,
    @QuestionnaireTypeId bigint,
    @OSTypeId bigint,
    @ModelVariantId bigint,
    @ParentId bigint
AS
    BEGIN

		SELECT qt.Id
			  , qt.ProductTypeId
			  , qt.QuestionnaireTypeId
			  , qt.OSTypeId
			  , @ModelVariantId ModelVariantId
			  , qt.QuestionnaireTypeName
			  , qt.QuestionnaireTypeDisplayName
			  , qt.QuestionnaireTypeEnumName
			  , qt.Identifier
			  , qt.ParentId
			  , qt.Name
			  , qt.DisplayName
			  , qt.EnumName
			  , qt.SubHeading
			  , qt.Type
			  , qt.AnswerType
			  , qt.Threshold
			  , qt.ThresholdLevel
			  , qt.RowOrder
			  , qt.DisplayInList
			  , qt.ThumbnailPath
			  , qt.IsEditable
		  FROM vw_QuestionnaireTemplates qt
		  Where (
					(@ProductTypeId is null or qt.ProductTypeId = @ProductTypeId)
					And (@QuestionnaireTypeId is null or qt.QuestionnaireTypeId = @QuestionnaireTypeId)
					And (@OSTypeId is null or qt.OSTypeId = @OSTypeId)
					And (@ModelVariantId is null or qt.ModelVariantId is null or qt.ModelVariantId = @ModelVariantId)
					And (@ParentId is null or qt.ParentId = @ParentId)
				)
		  Except
		  SELECT qt2.Id
			  , qt2.ProductTypeId
			  , qt2.QuestionnaireTypeId
			  , qt2.OSTypeId
			  , @ModelVariantId ModelVariantId
			  , qt2.QuestionnaireTypeName
			  , qt2.QuestionnaireTypeDisplayName
			  , qt2.QuestionnaireTypeEnumName
			  , qt2.Identifier
			  , qt2.ParentId
			  , qt2.Name
			  , qt2.DisplayName
			  , qt2.EnumName
			  , qt2.SubHeading
			  , qt2.Type
			  , qt2.AnswerType
			  , qt2.Threshold
			  , qt2.ThresholdLevel
			  , qt2.RowOrder
			  , qt2.DisplayInList
			  , qt2.ThumbnailPath
			  , qt2.IsEditable
		  FROM vw_QuestionnaireTemplates qt2
		  Where (
					qt2.Enabled = 0
					And (@ProductTypeId is null or qt2.ProductTypeId = @ProductTypeId)
					And (@QuestionnaireTypeId is null or qt2.QuestionnaireTypeId = @QuestionnaireTypeId)
					And (@OSTypeId is null or qt2.OSTypeId = @OSTypeId)
					And (@ModelVariantId is null or qt2.ModelVariantId = @ModelVariantId)
					And (@ParentId is null or qt2.ParentId = @ParentId)
				)
		Order by QuestionnaireTypeId, RowOrder

End
GO

ALTER PROCEDURE [dbo].[GetQuestionnaireTemplateList]
   @WhereClause varchar(200) = null,
    @SortOrder varchar(100) = null,
    @OffsetStart int = null,
    @RowsPerPage int = null
AS
    BEGIN

                Declare @inSortOrder varchar(50) = @SortOrder;
                Declare @inWhereClause varchar(50) = @WhereClause;
                Declare @inOffsetStart int = @OffsetStart;
                Declare @inRowsPerPage int = @RowsPerPage;
                Declare @SortColumn varchar(50);
                Declare @Direction varchar(4);

                Select @inOffsetStart = OffsetStart, @inRowsPerPage = RowsPerPage, @SortColumn = SortColumn, @Direction = Direction, @inWhereClause = WhereClause From 
                                    [dbo].[fn_GetSPDefaults] (@inOffsetStart, @inRowsPerPage, @inSortOrder, @inWhereClause);

                Select 
                     Id,
                     ProductTypeId,
                     QuestionnaireTypeId,
                     OSTypeId,
                     ModelVariantId,
                     Identifier,
                     ParentId,
                     ThresholdLevel,
                     Name,
                     DisplayName,
                     EnumName,
                     SubHeading,
                     Type,
                     AnswerType,
                     Threshold,
                     RowOrder,
                     DisplayInList,
                     ThumbnailPath,
                     Enabled,
                     Active,
                     Created,
                     CreatedBy,
                     Modified,
                     ModifiedBy,
					 IsEditable,
                     COUNT(*) OVER() as TotalRowsCount
                 From vw_QuestionnaireTemplateList
                Where (@inWhereClause Is Null
                        Or (Name LIKE @inWhereClause
                             OR DisplayName LIKE @inWhereClause
                             OR EnumName LIKE @inWhereClause
                             OR SubHeading LIKE @inWhereClause
                             OR Type LIKE @inWhereClause
                             OR AnswerType LIKE @inWhereClause
                             OR ThumbnailPath LIKE @inWhereClause
                        )
                     )
                ORDER BY
                CASE WHEN @Direction = 'ASC' Then
                    CASE @SortColumn
                        WHEN 'NAME' THEN Name
                        WHEN 'DISPLAYNAME' THEN DisplayName
                        WHEN 'ENUMNAME' THEN EnumName
                        WHEN 'SUBHEADING' THEN SubHeading
                        WHEN 'TYPE' THEN Type
                        WHEN 'ANSWERTYPE' THEN AnswerType
                        WHEN 'THUMBNAILPATH' THEN ThumbnailPath
                        WHEN 'CREATED' THEN CONVERT(CHAR(19), Created, 120)
                        WHEN 'MODIFIED' THEN CONVERT(CHAR(19), Modified, 120)
                    ELSE NULL
                    End
                End ASC,
                CASE WHEN @Direction = 'DESC' Then
                    CASE @SortColumn
                        WHEN 'NAME' THEN Name
                        WHEN 'DISPLAYNAME' THEN DisplayName
                        WHEN 'ENUMNAME' THEN EnumName
                        WHEN 'SUBHEADING' THEN SubHeading
                        WHEN 'TYPE' THEN Type
                        WHEN 'ANSWERTYPE' THEN AnswerType
                        WHEN 'THUMBNAILPATH' THEN ThumbnailPath
                        WHEN 'CREATED' THEN CONVERT(CHAR(19), Created, 120)
                        WHEN 'MODIFIED' THEN CONVERT(CHAR(19), Modified, 120)
                    ELSE NULL
                    End
                End DESC
                OFFSET @inOffsetStart ROWS 
                FETCH NEXT @inRowsPerPage ROWS ONLY
End
GO

ALTER PROCEDURE [dbo].[GetQuestionnaireBasedModelVariantId] 
	-- Add the parameters for the stored procedure here
	@ModelVariantId int
	
AS
BEGIN
	-- SET NOCOUNT ON added to prevent extra result sets from
	-- interfering with SELECT statements.
	SET NOCOUNT ON;
	declare @Count  int

	set @Count=0;

	select @Count = Count(*) from QuestionnaireTemplate where ModelVariantId = @ModelVariantId

IF  @Count > 0  
	BEGIN
		SELECT Id,
				ProductTypeId,
				QuestionnaireTypeId,
				OSTypeId,
				ModelVariantId,
				Identifier,
				ParentId,
				ThresholdLevel,
				[Name],
				DisplayName,
				EnumName,
				SubHeading,
				[Type],
				AnswerType,
				Threshold,
				RowOrder,
				DisplayInList,
				ThumbnailPath,
				[Enabled],
				Active,
				IsEditable
		FROM vw_QuestionnaireTemplates 
		WHERE ModelVariantId = @ModelVariantId;
	END
ELSE
	BEGIN
		SELECT 0 as Id,
				ProductTypeId,
				QuestionnaireTypeId,
				OSTypeId,
				@ModelVariantId as ModelVariantId,
				Identifier,
				ParentId,
				ThresholdLevel,
				[Name],
				DisplayName,
				EnumName,
				SubHeading,
				[Type],
				AnswerType,
				Threshold,
				RowOrder,
				DisplayInList,
				ThumbnailPath,
				[Enabled],
				Active,
				IsEditable
		FROM vw_QuestionnaireTemplates 
		WHERE ModelVariantId is null ;
	END
END
GO